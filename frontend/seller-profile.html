<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Profile - BookResell</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .seller-profile-header {
            background-color: #f8f9fa;
            padding: 2rem 0;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
        .seller-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #fff;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .seller-stats {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }
        .stat-item {
            text-align: center;
            flex: 1;
            min-width: 120px;
            padding: 1rem;
            border-right: 1px solid #dee2e6;
        }
        .stat-item:last-child {
            border-right: none;
        }
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4a6da7;
            display: block;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .review {
            border-bottom: 1px solid #dee2e6;
            padding: 1rem 0;
        }
        .review:last-child {
            border-bottom: none;
        }
        .stars {
            color: #ffc107;
            margin-bottom: 0.5rem;
        }
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        .contact-btn {
            margin-top: 1.5rem;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="index.html">BookResell</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="nav-books">Books</a>
                        </li>
                        <li class="nav-item seller-only" style="display: none">
                            <a class="nav-link" href="seller-dashboard.html">Seller Dashboard</a>
                        </li>
                        <li class="nav-item authenticated" style="display: none">
                            <a class="nav-link" href="chat.html">Messages</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="cart.html">
                                <i data-feather="shopping-cart"></i>
                                <span id="cart-count" class="badge bg-danger rounded-pill">0</span>
                            </a>
                        </li>
                        <li class="nav-item authenticated" style="display: none">
                            <span class="navbar-text me-2" id="username-display"></span>
                        </li>
                        <li class="nav-item authenticated" style="display: none">
                            <button class="btn btn-light" id="logout-btn">Logout</button>
                        </li>
                        <li class="nav-item unauthenticated">
                            <a href="login.html" class="btn btn-light me-2">Login</a>
                        </li>
                        <li class="nav-item unauthenticated">
                            <a href="register.html" class="btn btn-outline-light">Register</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container py-4">
        <!-- Seller not found message -->
        <div id="seller-not-found" class="alert alert-danger" style="display: none;">
            Seller not found. The seller you're looking for might have been removed or doesn't exist.
        </div>

        <!-- Loading indicator -->
        <div id="loading-indicator" class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <!-- Seller Profile Container -->
        <div id="seller-profile-container" style="display: none;">
            <!-- Seller Profile Header -->
            <div class="seller-profile-header">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            <img src="https://via.placeholder.com/120" alt="Seller Avatar" class="seller-avatar" id="seller-avatar">
                        </div>
                        <div class="col-md-7">
                            <h1 id="seller-name">Seller Name</h1>
                            <p class="text-muted mb-0" id="seller-joined">Joined: January 2023</p>
                            <div class="d-flex align-items-center mt-2">
                                <div class="stars me-2">
                                    <i data-feather="star" class="text-warning"></i>
                                    <i data-feather="star" class="text-warning"></i>
                                    <i data-feather="star" class="text-warning"></i>
                                    <i data-feather="star" class="text-warning"></i>
                                    <i data-feather="star" class="text-secondary"></i>
                                </div>
                                <span id="seller-rating">(4.1/5)</span>
                            </div>
                        </div>
                        <div class="col-md-3 text-end">
                            <button class="btn btn-primary btn-lg" id="contact-seller-btn">
                                <i data-feather="message-square"></i> Contact Seller
                            </button>
                        </div>
                    </div>
                    
                    <!-- Seller Stats -->
                    <div class="seller-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="books-count">124</span>
                            <span class="stat-label">Books Sold</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="listings-count">18</span>
                            <span class="stat-label">Active Listings</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="response-time">98%</span>
                            <span class="stat-label">Response Rate</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="avg-response-time">2h</span>
                            <span class="stat-label">Avg. Response Time</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- Seller Books -->
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3 class="mb-0">Books Available From This Seller</h3>
                        </div>
                        <div class="card-body">
                            <div id="seller-books" class="book-grid">
                                <!-- Books will be loaded here -->
                                <div class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                            <div id="no-books-message" class="text-center py-4" style="display: none;">
                                <p class="text-muted">This seller has no books available at the moment.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Seller Reviews -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3 class="mb-0">Reviews</h3>
                            <span class="badge bg-primary rounded-pill" id="reviews-count">42</span>
                        </div>
                        <div class="card-body">
                            <div id="seller-reviews">
                                <!-- Reviews will be loaded here -->
                                <div class="review">
                                    <div class="stars">
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                    </div>
                                    <p class="review-text">Great seller! Book was in excellent condition, just as described. Fast shipping too!</p>
                                    <p class="text-muted mb-0">- John D., 2 weeks ago</p>
                                </div>
                                <div class="review">
                                    <div class="stars">
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-secondary"></i>
                                    </div>
                                    <p class="review-text">Good communication and prompt delivery. The book had a bit more wear than expected.</p>
                                    <p class="text-muted mb-0">- Priya S., 1 month ago</p>
                                </div>
                                <div class="review">
                                    <div class="stars">
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                        <i data-feather="star" class="text-warning"></i>
                                    </div>
                                    <p class="review-text">Amazing seller! Very helpful and responsive. Will definitely buy from again.</p>
                                    <p class="text-muted mb-0">- Rahul M., 2 months ago</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <button class="btn btn-outline-primary btn-sm mt-3" id="load-more-reviews">Load More Reviews</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer mt-auto py-3 bg-light">
        <div class="container text-center">
            <span class="text-muted">© 2023 BookResell - A marketplace for pre-loved books</span>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/books.js"></script>
    <script src="js/cart.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Feather icons
            feather.replace();
            
            // Get seller ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const sellerId = urlParams.get('id');
            
            if (!sellerId) {
                document.getElementById('seller-not-found').style.display = 'block';
                document.getElementById('loading-indicator').style.display = 'none';
                return;
            }
            
            // Set up authentication UI
            updateAuthUI();
            updateCartCount();
            
            // Fetch seller details
            fetch(`/api/users/${sellerId}`, {
                headers: getAuthHeaders()
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Seller not found');
                }
                return response.json();
            })
            .then(seller => {
                // Hide loading, show content
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('seller-profile-container').style.display = 'block';
                
                // Populate seller details
                document.getElementById('seller-name').textContent = seller.username;
                
                // Format join date
                const joinedDate = new Date(seller.created_at);
                document.getElementById('seller-joined').textContent = `Joined: ${joinedDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}`;
                
                // Set seller avatar if available
                if (seller.avatar_url) {
                    document.getElementById('seller-avatar').src = seller.avatar_url;
                }
                
                // Set up contact button
                document.getElementById('contact-seller-btn').addEventListener('click', function() {
                    if (!isAuthenticated()) {
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    // Redirect to chat page with seller info
                    window.location.href = `chat.html?seller_id=${sellerId}`;
                });
                
                // Load seller's books
                loadSellerBooks(sellerId);
            })
            .catch(error => {
                console.error('Error fetching seller details:', error);
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('seller-not-found').style.display = 'block';
            });
            
            // Function to load seller's books
            function loadSellerBooks(sellerId) {
                fetch(`/api/books?seller_id=${sellerId}`, {
                    headers: getAuthHeaders()
                })
                .then(response => response.json())
                .then(books => {
                    const container = document.getElementById('seller-books');
                    container.innerHTML = '';
                    
                    if (books.length === 0) {
                        document.getElementById('no-books-message').style.display = 'block';
                        return;
                    }
                    
                    books.forEach(book => {
                        const bookCard = createBookCard(book);
                        container.appendChild(bookCard);
                    });
                    
                    // Update listings count
                    document.getElementById('listings-count').textContent = books.length;
                    
                    // Initialize feather icons in newly created elements
                    feather.replace();
                })
                .catch(error => {
                    console.error('Error fetching seller books:', error);
                    document.getElementById('seller-books').innerHTML = 
                        '<div class="text-center py-4"><p class="text-muted">Failed to load books</p></div>';
                });
            }
            
            // Load more reviews button
            document.getElementById('load-more-reviews').addEventListener('click', function() {
                // In a real app, this would load more reviews from the API
                alert('This would load more reviews in the actual implementation');
            });
        });
    </script>
</body>
</html>